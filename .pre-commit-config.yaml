# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

---
# https://pre-commit.com/#installation
default_stages: [pre-commit, pre-push]
default_language_version:
  # force all unspecified Python hooks to run python3
  python: python3
  # force all unspecified Node hooks to run Node.js v22.17.0 LTS
  node: 22.20.0
minimum_pre_commit_version: '3.2.0'
repos:
  - repo: meta
    hooks:
      - id: identity
        name: run identity check
        description: check you have set your git identity
      - id: check-hooks-apply
        name: run check hooks apply
        description: check that all the hooks apply to the repository
  - repo: https://github.com/thlorenz/doctoc.git
    rev: v2.2.0
    hooks:
      - id: doctoc
        name: add TOC for Markdown files
        description: automatically keeps your table of contents up to date
        files: ^README\.md$
  - repo: local
    hooks:
      - id: prettier
        name: run prettier
        description: format files with prettier
        entry: prettier --write '**/*.js' '**/*.yaml' '**/*.yml'
        files: \.(js|ya?ml)$
        language: node
        additional_dependencies: ['prettier@3.6.2']
      - id: maven-spotless-apply
        name: maven spotless apply
        description: automatically formats Java and Scala code using mvn spotless:apply.
        entry: mvn spotless:apply
        language: system # Indicates that the 'entry' command should be run directly as a system command.
        types: [java, scala] # Specifies that this hook should run on Java and Scala files.
        pass_filenames:
          false # Crucial: tells pre-commit NOT to pass filenames as arguments to 'mvn spotless:apply'.
          # Spotless typically scans the whole project based on its configuration.
        always_run:
          true # Ensures this hook runs even if no Java files are changed.
          # This is useful for spotless:apply which might affect files not staged.
        stages: [manual]
      - id: check-zip-file-is-not-committed
        name: check no zip files are committed
        description: Zip files are not allowed in the repository
        language: fail
        entry: |
          Zip files are not allowed in the repository as they are hard to
          track and have security implications. Please remove the zip file from the repository.
        files: (?i)\.zip$
      - id: check-makefiles-tabs
        name: check Makefiles files for tabs
        description: ensures that Makefiles are indented with tabs
        entry: ./scripts/pre-commit/check_makefiles_for_tabs.sh # Path to your script
        language: system
        files: '(?i)makefile$'
        pass_filenames: true # <-- Crucial change: pass filenames to the script
        types: [file] # Ensure only regular files are passed, not directories
        stages: [manual]
  - repo: https://github.com/Lucas-C/pre-commit-hooks
    rev: v1.5.5
    hooks:
      - id: chmod
        name: set file permissions
        description: manual hook to be run by macOS or Linux users for a full repository clean up
        args: ['644']
        files: \.md$
        stages: [manual]
      - id: insert-license
        name: add license for all Batch files
        files: \.bat$
        args:
          - --comment-style
          - '|REM|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all .c files
        description: automatically adds a licence header to all C files that don't have a license header
        files: \.c$
        args:
          - --comment-style
          - '/*|*|*/'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all .h files
        description: automatically adds a licence header to all header files that don't have a license header
        files: \.h$
        args:
          - --comment-style
          - '/*| *| */'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all Java files
        description: automatically adds a licence header to all Java files that don't have a license header
        files: \.java$
        args:
          - --comment-style
          - '/*|*|*/'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all Markdown files
        description: automatically adds a licence header to all Markdown files that don't have a license header
        files: \.md$
        args:
          - --comment-style
          - '<!--|| -->'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
        exclude: ^docs/index\.md$|^\.github/pull_request_template\.md$|\.github/issue_template\.md$|^docs/blog/.*\.md$
      - id: insert-license
        name: add license for all Makefile files
        description: automatically adds a licence header to all Makefiles that don't have a license header
        files: ^Makefile$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all R files
        description: automatically adds a licence header to all R files that don't have a license header
        files: \.R$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all Scala files
        description: automatically adds a licence header to all Scala files that don't have a license header
        files: \.scala$
        args:
          - --comment-style
          - '/*| *| */'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all Shell files
        description: automatically adds a licence header to all Shell files that don't have a license header
        files: \.sh$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all TOML files
        description: automatically adds a licence header to all TOML files that don't have a license header
        files: \.toml$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all YAML files
        description: automatically adds a licence header to all YAML files that don't have a license header
        files: \.ya?ml$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all Python files
        description: automatically adds a licence header to all Python files that don't have a license header
        files: \.py$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
      - id: insert-license
        name: add license for all other files
        description: automatically adds a licence header to all other files that don't have a license header
        files: ^\.(editorconfig|gitattributes|prettierignore|prettierrc|shellcheckrc)$|^.*/\.gitignore$|^tools/maven/scalafmt\.conf$
        args:
          - --comment-style
          - '|#|'
          - --license-filepath
          - .github/workflows/license-templates/LICENSE.txt
          - --fuzzy-match-generates-todo
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.21.0
    hooks:
      - id: pyupgrade
        name: run pyupgrade
        description: a tool (and pre-commit hook) to automatically upgrade syntax for newer versions of the language
        args: [--py37-plus]
  - repo: https://github.com/psf/black-pre-commit-mirror
    rev: 25.9.0
    hooks:
      - id: black-jupyter
        name: run black-jupyter
        description: format Python files and Jupyter Notebooks with black
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v20.1.7
    hooks:
      - id: clang-format
        name: run clang-format
        description: format C files with clang-format
        args: [--style=Google]
        types_or: [c]
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.6
    hooks:
      - id: bandit
        name: run bandit
        description: check Python code for security issues
        args: ['-c=pyproject.toml', '-r']
        additional_dependencies: ['bandit[toml]']
  - repo: https://github.com/codespell-project/codespell
    rev: v2.4.1
    hooks:
      - id: codespell
        name: run codespell
        description: check spelling with codespell
        args: [--ignore-words=.github/linters/codespell.txt]
        exclude: ^docs/image|^spark/common/src/test/resources|^docs/usecases|^tools/maven/scalafmt|osmpbf/build|^docker/zeppelin|^docs-overrides
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.28.0
    hooks:
      - id: gitleaks
        name: run gitleaks
        description: check for secrets with gitleaks
  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.10.0
    hooks:
      - id: rst-backticks
        name: run rst-backticks
        description: detect common mistake of using single backticks when writing rst
      - id: rst-directive-colons
        name: run rst-directive-colons
        description: detect mistake of rst directive not ending with double colon or space before the double colon
      - id: rst-inline-touching-normal
        name: run rst-inline-touching-normal
        description: detect mistake of inline code touching normal text in rst
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-ast
        name: run check-ast
        description: check Python files for syntax errors
      - id: check-builtin-literals
        name: run check-builtin-literals
        description: check Python files for proper use of built-in literals
      - id: check-case-conflict
        name: run check-case-conflict
        description: check for case conflicts in file names
      - id: check-docstring-first
        name: run check-docstring-first
        description: check that docstrings are at the start of functions
      - id: check-executables-have-shebangs
        name: run check-executables-have-shebangs
        description: check that executable scripts have shebang lines
      - id: check-illegal-windows-names
        name: run check-illegal-windows-names
        description: check for Windows-illegal file names
      - id: check-json
        name: run check-json
        description: check JSON files for syntax errors
        exclude: ^docs/usecases/data/testPolygon\.json$|^spark/common/src/test/resources/.*\.json$
      - id: check-merge-conflict
        name: run check-merge-conflict
        description: check for merge conflict markers
      - id: check-shebang-scripts-are-executable
        name: run check-shebang-scripts-are-executable
        description: check that scripts with shebangs are executable
      - id: check-toml
        name: run check-toml
        description: check TOML files for syntax errors
      - id: check-vcs-permalinks
        name: run check-vcs-permalinks
        description: ensures that links to vcs websites are permalinks
      - id: check-xml
        name: run check-xml
        description: attempts to load all xml files to verify syntax
      - id: check-yaml
        name: run check-yaml
        description: attempts to load all yaml files to verify syntax
        exclude: ^mkdocs\.yml$
      - id: debug-statements
        name: run debug-statements
        description: check for debugger imports and py37+ `breakpoint()` calls in python source.
      - id: destroyed-symlinks
        name: run destroyed-symlinks
        description: detects symlinks which are changed to regular files with a content of a path which that symlink was pointing to
      - id: detect-aws-credentials
        name: run detect-aws-credentials
        description: checks for the existence of AWS secrets that you have set up with the AWS CLI
        args: [--allow-missing-credentials]
      - id: detect-private-key
        name: run detect-private-key
        description: checks for the existence of private keys
      - id: end-of-file-fixer
        name: run end-of-file-fixer
        description: makes sure files end in a newline and only a newline
        exclude: \.svg$|^docs/image|^spark/common/src/test/resources
      - id: file-contents-sorter
        name: run file-contents-sorter
        description: sort the lines in specified files (defaults to alphabetical)
        args: [--unique]
        files: ^\.github/linters/codespell\.txt$
      - id: fix-byte-order-marker
        name: run fix-byte-order-marker
        description: removes UTF-8 byte order marker
      - id: forbid-submodules
        name: run forbid-submodules
        description: forbids any submodules in the repository
      - id: mixed-line-ending
        name: run mixed-line-ending
        description: replaces or checks mixed line ending
        exclude: \.csv$
      - id: name-tests-test
        name: run name-tests-test
        description: verifies that test files are named correctly
        args: [--pytest-test-first]
        exclude: |
          (?x)^(
              python/tests/properties/crs_transform\.py|
              python/tests/properties/linestring_properties\.py|
              python/tests/properties/point_properties\.py|
              python/tests/properties/polygon_properties\.py|
              python/tests/sql/resource/sample_data\.py|
              python/tests/streaming/spark/cases_builder\.py|
              python/tests/tools\.py
          )$
      - id: requirements-txt-fixer
        name: run requirements-txt-fixer
        description: sorts entries in the Python requirements files and removes incorrect entry for pkg-resources==0.0.0
        files: ^docker/requirements\.txt$
      - id: trailing-whitespace
        name: run trailing-whitespace
        description: trims trailing whitespace
        args: [--markdown-linebreak-ext=md]
        exclude: ^docs-overrides/main\.html$|\.Rd$
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.45.0
    hooks:
      - id: markdownlint
        name: run markdownlint
        description: check Markdown files with markdownlint
        args: [--config=.github/linters/.markdown-lint.yml]
        exclude: ^\.github/.*$
        types: [markdown]
        files: \.(md|mdown|markdown)$
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.11.0.1
    hooks:
      - id: shellcheck
        name: run shellcheck
        description: check Shell scripts with shellcheck
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        name: run yamllint
        description: check YAML files with yamllint
        args: [--strict, -c=.github/linters/.yaml-lint.yml]
        types: [yaml]
        files: \.ya?ml$
  - repo: https://github.com/oxipng/oxipng
    rev: v9.1.5
    hooks:
      - id: oxipng
        name: run oxipng
        description: check PNG files with oxipng
        args: ['--fix', '-o', '4', '--strip', 'safe', '--alpha']
        stages: [manual]
  - repo: https://github.com/adamchainz/blacken-docs
    rev: 1.20.0
    hooks:
      - id: blacken-docs
        name: run blacken-docs
        description: run `black` on python code blocks in documentation files
        additional_dependencies: [black==25.1.0]
